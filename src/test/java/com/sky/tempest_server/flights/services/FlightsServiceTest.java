package com.sky.tempest_server.flights.services;

import com.sky.tempest_server.flights.entities.Airport;
import com.sky.tempest_server.flights.entities.City;
import com.sky.tempest_server.flights.entities.Flight;
import com.sky.tempest_server.flights.entities.Location;
import com.sky.tempest_server.flights.exceptions.InvalidLocationTypeException;
import com.sky.tempest_server.flights.repositories.AirportRepository;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.MockitoJUnitRunner;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpEntity;

import java.util.List;
import java.util.Optional;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;


@SpringBootTest
@RunWith(MockitoJUnitRunner.class)
public class FlightsServiceTest {

    private final String testAirportSearchJsonResponse = "{\"locations\":[{\"id\":\"LGW\",\"int_id\":8949,\"airport_int_id\":8949,\"active\":true,\"code\":\"LGW\",\"icao\":\"EGKK\",\"name\":\"Gatwick\",\"slug\":\"gatwick-london-united-kingdom\",\"slug_en\":\"gatwick-london-united-kingdom\",\"alternative_names\":[\"Gatwick (London)\",\"London Gatwick (North Terminal)\"],\"rank\":16,\"global_rank_dst\":23,\"dst_popularity_score\":1372925.0,\"timezone\":\"Europe\\/London\",\"city\":{\"id\":\"london_gb\",\"name\":\"London\",\"code\":\"LON\",\"slug\":\"london-united-kingdom\",\"subdivision\":null,\"continent\":{\"id\":\"europe\",\"name\":\"Europe\",\"slug\":\"europe\",\"code\":\"EU\"},\"region\":{\"id\":\"northern-europe\",\"name\":\"Northern Europe\",\"slug\":\"northern-europe\"},\"autonomous_territory\":null,\"country\":{\"id\":\"GB\",\"name\":\"United Kingdom\",\"slug\":\"united-kingdom\",\"code\":\"GB\"},\"nearby_country\":null},\"location\":{\"lat\":51.148056,\"lon\":-0.190278},\"alternative_departure_points\":[{\"id\":\"SEN\",\"distance\":101.11,\"duration\":4740.5},{\"id\":\"LTN\",\"distance\":120.04,\"duration\":5264.8},{\"id\":\"STN\",\"distance\":121.4,\"duration\":5565.6},{\"id\":\"SOU\",\"distance\":144.28,\"duration\":6106.5},{\"id\":\"BOH\",\"distance\":186.14,\"duration\":7906.4},{\"id\":\"BHX\",\"distance\":231.22,\"duration\":9874.8},{\"id\":\"BRS\",\"distance\":232.58,\"duration\":10471.9},{\"id\":\"NWI\",\"distance\":249.24,\"duration\":10912.2},{\"id\":\"GB-BRIG-BRI1\",\"distance\":35.06,\"duration\":1616.9},{\"id\":\"GB-BRIG-BRI3\",\"distance\":36.15,\"duration\":1702.9},{\"id\":\"GB-BRIG-BRI2\",\"distance\":37.54,\"duration\":1843.7},{\"id\":\"GB-BRIG-BRIG\",\"distance\":39.44,\"duration\":2040},{\"id\":\"GB-HOVE-KING\",\"distance\":40.55,\"duration\":2122.6},{\"id\":\"GB-BRIG-BRI0\",\"distance\":41.36,\"duration\":2328.7},{\"id\":\"GB-HOVE-PORT\",\"distance\":42.16,\"duration\":2081.5},{\"id\":\"GB-SOUT-WEST\",\"distance\":43.84,\"duration\":2161},{\"id\":\"GB-LOND-WAND\",\"distance\":46.48,\"duration\":3044.4},{\"id\":\"GB-SHOR-SHOR\",\"distance\":47.66,\"duration\":2203},{\"id\":\"GB-LOND-ELEP\",\"distance\":48.43,\"duration\":3554.6},{\"id\":\"GB-LOND-WALW\",\"distance\":48.94,\"duration\":3727.4},{\"id\":\"GB-LOND-VICT\",\"distance\":48.97,\"duration\":3574},{\"id\":\"GB-SHOR-SHO0\",\"distance\":49.7,\"duration\":2335.6},{\"id\":\"LHR\",\"distance\":69.29,\"duration\":3305.5},{\"id\":\"LCY\",\"distance\":85.32,\"duration\":4193.5}],\"tags\":[{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"famous cities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1}],\"providers\":[1035,1053,1165,1175,1277,1282,1283,1284,1329],\"special\":[{\"id\":\"natural-history-museum_poi\",\"name\":\"Natural History Museum\",\"slug\":\"natural-history-museum\"},{\"id\":\"st-paul-s-cathedral_poi\",\"name\":\"St. Paul's Cathedral\",\"slug\":\"st-paul-s-cathedral\"},{\"id\":\"tate-modern_poi\",\"name\":\"Tate Modern\",\"slug\":\"tate-modern\"},{\"id\":\"isle-of-wight_poi\",\"name\":\"Isle of Wight\",\"slug\":\"isle-of-wight\"},{\"id\":\"tower-of-london_poi\",\"name\":\"Tower of London\",\"slug\":\"tower-of-london\"},{\"id\":\"canterbury-cathedral_poi\",\"name\":\"Canterbury Cathedral\",\"slug\":\"canterbury-cathedral\"},{\"id\":\"british-museum_poi\",\"name\":\"British Museum\",\"slug\":\"british-museum\"},{\"id\":\"roman-baths-bath_poi\",\"name\":\"Roman Baths, Bath\",\"slug\":\"roman-baths\"},{\"id\":\"avebury_poi\",\"name\":\"Avebury\",\"slug\":\"avebury\"},{\"id\":\"portsea-island_poi\",\"name\":\"Portsea Island\",\"slug\":\"portsea-island\"},{\"id\":\"stonehenge_poi\",\"name\":\"Stonehenge\",\"slug\":\"stonehenge\"}],\"tourist_region\":[{\"id\":\"greater-london_poi\",\"name\":\"Greater London\",\"slug\":\"greater-london\"}],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"4435087\",\"4284212\"]}],\"new_ground\":false,\"routing_priority\":0,\"type\":\"airport\"},{\"id\":\"STN\",\"int_id\":813,\"airport_int_id\":813,\"active\":true,\"code\":\"STN\",\"icao\":\"EGSS\",\"name\":\"London Stansted\",\"slug\":\"london-stansted-london-united-kingdom\",\"slug_en\":\"london-stansted-london-united-kingdom\",\"alternative_names\":[],\"rank\":37,\"global_rank_dst\":53,\"dst_popularity_score\":710187.0,\"timezone\":\"Europe\\/London\",\"city\":{\"id\":\"london_gb\",\"name\":\"London\",\"code\":\"LON\",\"slug\":\"london-united-kingdom\",\"subdivision\":null,\"continent\":{\"id\":\"europe\",\"name\":\"Europe\",\"slug\":\"europe\",\"code\":\"EU\"},\"region\":{\"id\":\"northern-europe\",\"name\":\"Northern Europe\",\"slug\":\"northern-europe\"},\"autonomous_territory\":null,\"country\":{\"id\":\"GB\",\"name\":\"United Kingdom\",\"slug\":\"united-kingdom\",\"code\":\"GB\"},\"nearby_country\":null},\"location\":{\"lat\":51.885,\"lon\":0.235},\"alternative_departure_points\":[{\"id\":\"LGW\",\"distance\":120.54,\"duration\":5574.9},{\"id\":\"NWI\",\"distance\":143.49,\"duration\":6835.9},{\"id\":\"SOU\",\"distance\":191.65,\"duration\":8708.7},{\"id\":\"BHX\",\"distance\":194.02,\"duration\":8631.6},{\"id\":\"EMA\",\"distance\":200.75,\"duration\":8664.3},{\"id\":\"DSA\",\"distance\":232.75,\"duration\":10428.6},{\"id\":\"BOH\",\"distance\":233.51,\"duration\":10508.6},{\"id\":\"GB-BRAI-MARK\",\"distance\":34.91,\"duration\":1864.1},{\"id\":\"GB-CAMB-CAM2\",\"distance\":49.63,\"duration\":2695.9},{\"id\":\"LCY\",\"distance\":55.86,\"duration\":3186.5},{\"id\":\"LTN\",\"distance\":65.87,\"duration\":3992.5},{\"id\":\"SEN\",\"distance\":67.25,\"duration\":3848.4},{\"id\":\"LHR\",\"distance\":97.99,\"duration\":5113}],\"tags\":[{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"famous cities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1}],\"providers\":[1053,1277,1282,1283,1284,1329],\"special\":[{\"id\":\"british-museum_poi\",\"name\":\"British Museum\",\"slug\":\"british-museum\"},{\"id\":\"portsea-island_poi\",\"name\":\"Portsea Island\",\"slug\":\"portsea-island\"},{\"id\":\"canterbury-cathedral_poi\",\"name\":\"Canterbury Cathedral\",\"slug\":\"canterbury-cathedral\"},{\"id\":\"natural-history-museum_poi\",\"name\":\"Natural History Museum\",\"slug\":\"natural-history-museum\"},{\"id\":\"stonehenge_poi\",\"name\":\"Stonehenge\",\"slug\":\"stonehenge\"},{\"id\":\"st-paul-s-cathedral_poi\",\"name\":\"St. Paul's Cathedral\",\"slug\":\"st-paul-s-cathedral\"},{\"id\":\"isle-of-wight_poi\",\"name\":\"Isle of Wight\",\"slug\":\"isle-of-wight\"},{\"id\":\"tower-of-london_poi\",\"name\":\"Tower of London\",\"slug\":\"tower-of-london\"},{\"id\":\"tate-modern_poi\",\"name\":\"Tate Modern\",\"slug\":\"tate-modern\"}],\"tourist_region\":[{\"id\":\"greater-london_poi\",\"name\":\"Greater London\",\"slug\":\"greater-london\"}],\"car_rentals\":[],\"new_ground\":false,\"routing_priority\":0,\"type\":\"airport\"},{\"id\":\"LHR\",\"int_id\":3940,\"airport_int_id\":3940,\"active\":true,\"code\":\"LHR\",\"icao\":\"EGLL\",\"name\":\"Heathrow\",\"slug\":\"heathrow-london-united-kingdom\",\"slug_en\":\"heathrow-london-united-kingdom\",\"alternative_names\":[\"Heathrow (London)\"],\"rank\":17,\"global_rank_dst\":6,\"dst_popularity_score\":3889128.0,\"timezone\":\"Europe\\/London\",\"city\":{\"id\":\"london_gb\",\"name\":\"London\",\"code\":\"LON\",\"slug\":\"london-united-kingdom\",\"subdivision\":null,\"continent\":{\"id\":\"europe\",\"name\":\"Europe\",\"slug\":\"europe\",\"code\":\"EU\"},\"region\":{\"id\":\"northern-europe\",\"name\":\"Northern Europe\",\"slug\":\"northern-europe\"},\"autonomous_territory\":null,\"country\":{\"id\":\"GB\",\"name\":\"United Kingdom\",\"slug\":\"united-kingdom\",\"code\":\"GB\"},\"nearby_country\":null},\"location\":{\"lat\":51.4775,\"lon\":-0.461389},\"alternative_departure_points\":[{\"id\":\"SOU\",\"distance\":100.93,\"duration\":4496.5},{\"id\":\"STN\",\"distance\":105.95,\"duration\":4956},{\"id\":\"SEN\",\"distance\":123.26,\"duration\":5624.5},{\"id\":\"BOH\",\"distance\":142.79,\"duration\":6296.4},{\"id\":\"BHX\",\"distance\":169.63,\"duration\":7438.9},{\"id\":\"BRS\",\"distance\":181.58,\"duration\":8299.7},{\"id\":\"EMA\",\"distance\":190.1,\"duration\":8034.3},{\"id\":\"GB-LOND-HAMM\",\"distance\":21.01,\"duration\":1463.1},{\"id\":\"NWI\",\"distance\":217.28,\"duration\":9887.9},{\"id\":\"CWL\",\"distance\":243.03,\"duration\":10545},{\"id\":\"EXT\",\"distance\":247.65,\"duration\":11020.3},{\"id\":\"GB-LOND-VICT\",\"distance\":26.06,\"duration\":1953.8},{\"id\":\"GB-LOND-BISH\",\"distance\":26.34,\"duration\":1933.2},{\"id\":\"GB-LOND-WAND\",\"distance\":26.65,\"duration\":1982.3},{\"id\":\"GB-LOND-MARB\",\"distance\":26.89,\"duration\":1972.9},{\"id\":\"GB-LOND-MAR0\",\"distance\":27.12,\"duration\":2010.7},{\"id\":\"GB-LOND-LON2\",\"distance\":27.64,\"duration\":2087},{\"id\":\"GB-LOND-STJO\",\"distance\":28.7,\"duration\":2185.6},{\"id\":\"GB-LOND-LON3\",\"distance\":29.11,\"duration\":2092},{\"id\":\"GB-LOND-ELEP\",\"distance\":30.17,\"duration\":2478.7},{\"id\":\"GB-LOND-FIN0\",\"distance\":30.96,\"duration\":2241.5},{\"id\":\"GB-LOND-FINC\",\"distance\":31.72,\"duration\":2329.1},{\"id\":\"GB-LOND-WALW\",\"distance\":32.19,\"duration\":2653.6},{\"id\":\"GB-LOND-SHOR\",\"distance\":32.53,\"duration\":2751.3},{\"id\":\"GB-LOND-WHIT\",\"distance\":33.25,\"duration\":2819.2},{\"id\":\"GB-LOND-BETH\",\"distance\":33.99,\"duration\":2975.1},{\"id\":\"GB-WATF-LOND\",\"distance\":34.13,\"duration\":2257.3},{\"id\":\"GB-LOND-NEWC\",\"distance\":34.93,\"duration\":2934.2},{\"id\":\"GB-LOND-MILE\",\"distance\":35.11,\"duration\":3006.5},{\"id\":\"GB-LOND-BOWW\",\"distance\":36.11,\"duration\":3109.5},{\"id\":\"GB-LOND-LEWI\",\"distance\":37.45,\"duration\":3209},{\"id\":\"GB-LOND-STR0\",\"distance\":38.84,\"duration\":3451.2},{\"id\":\"GB-GUIL-TESC\",\"distance\":39.49,\"duration\":1943.9},{\"id\":\"GB-HEME-BRID\",\"distance\":40.54,\"duration\":2077.1},{\"id\":\"LCY\",\"distance\":42.23,\"duration\":3713.8},{\"id\":\"GB-ELTH-WEST\",\"distance\":43.37,\"duration\":3628.9},{\"id\":\"GB-READ-MERE\",\"distance\":43.47,\"duration\":2070.2},{\"id\":\"GB-LEWK-TURN\",\"distance\":49.51,\"duration\":2172.4},{\"id\":\"LTN\",\"distance\":58.45,\"duration\":2828.9},{\"id\":\"LGW\",\"distance\":69.61,\"duration\":3275.9}],\"tags\":[{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"famous cities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1}],\"providers\":[1035,1053,1096,1165,1175,1227,1229,1277,1282,1283,1284,1329],\"special\":[{\"id\":\"st-fagans-national-history-museum_poi\",\"name\":\"St Fagans: National History Museum\",\"slug\":\"st-fagans-national-history-museum\"},{\"id\":\"canterbury-cathedral_poi\",\"name\":\"Canterbury Cathedral\",\"slug\":\"canterbury-cathedral\"},{\"id\":\"british-museum_poi\",\"name\":\"British Museum\",\"slug\":\"british-museum\"},{\"id\":\"avebury_poi\",\"name\":\"Avebury\",\"slug\":\"avebury\"},{\"id\":\"isle-of-wight_poi\",\"name\":\"Isle of Wight\",\"slug\":\"isle-of-wight\"},{\"id\":\"tower-of-london_poi\",\"name\":\"Tower of London\",\"slug\":\"tower-of-london\"},{\"id\":\"portsea-island_poi\",\"name\":\"Portsea Island\",\"slug\":\"portsea-island\"},{\"id\":\"st-david-s-cathedral-cardiff_poi\",\"name\":\"St. David's Cathedral, Cardiff\",\"slug\":\"st-david-s-cathedral\"},{\"id\":\"tintern-abbey-united-kingdom_poi\",\"name\":\"Tintern Abbey, United Kingdom\",\"slug\":\"tintern-abbey\"},{\"id\":\"roman-baths-bath_poi\",\"name\":\"Roman Baths, Bath\",\"slug\":\"roman-baths\"},{\"id\":\"natural-history-museum_poi\",\"name\":\"Natural History Museum\",\"slug\":\"natural-history-museum\"},{\"id\":\"st-paul-s-cathedral_poi\",\"name\":\"St. Paul's Cathedral\",\"slug\":\"st-paul-s-cathedral\"},{\"id\":\"tate-modern_poi\",\"name\":\"Tate Modern\",\"slug\":\"tate-modern\"},{\"id\":\"stonehenge_poi\",\"name\":\"Stonehenge\",\"slug\":\"stonehenge\"}],\"tourist_region\":[{\"id\":\"greater-london_poi\",\"name\":\"Greater London\",\"slug\":\"greater-london\"}],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"245299\",\"164379\",\"4263809\",\"4343811\"]}],\"new_ground\":false,\"routing_priority\":0,\"type\":\"airport\"},{\"id\":\"LCY\",\"int_id\":9625,\"airport_int_id\":9625,\"active\":true,\"code\":\"LCY\",\"icao\":\"EGLC\",\"name\":\"London City\",\"slug\":\"london-city-london-united-kingdom\",\"slug_en\":\"london-city-london-united-kingdom\",\"alternative_names\":[\"City Airport (London)\"],\"rank\":229,\"global_rank_dst\":72,\"dst_popularity_score\":411709.0,\"timezone\":\"Europe\\/London\",\"city\":{\"id\":\"london_gb\",\"name\":\"London\",\"code\":\"LON\",\"slug\":\"london-united-kingdom\",\"subdivision\":null,\"continent\":{\"id\":\"europe\",\"name\":\"Europe\",\"slug\":\"europe\",\"code\":\"EU\"},\"region\":{\"id\":\"northern-europe\",\"name\":\"Northern Europe\",\"slug\":\"northern-europe\"},\"autonomous_territory\":null,\"country\":{\"id\":\"GB\",\"name\":\"United Kingdom\",\"slug\":\"united-kingdom\",\"code\":\"GB\"},\"nearby_country\":null},\"location\":{\"lat\":51.505,\"lon\":0.054167},\"alternative_departure_points\":[{\"id\":\"GB-LOND-BOWW\",\"distance\":10.38,\"duration\":1188.9},{\"id\":\"GB-LOND-STR0\",\"distance\":11.13,\"duration\":1342.2},{\"id\":\"GB-LOND-MILE\",\"distance\":11.51,\"duration\":1362},{\"id\":\"GB-LOND-WHIT\",\"distance\":11.89,\"duration\":1367.6},{\"id\":\"GB-LOND-BETH\",\"distance\":12.88,\"duration\":1441.5},{\"id\":\"GB-LOND-SHOR\",\"distance\":13.65,\"duration\":1578.4},{\"id\":\"SOU\",\"distance\":143.13,\"duration\":7952.1},{\"id\":\"GB-LOND-LEWI\",\"distance\":15.01,\"duration\":1709.6},{\"id\":\"GB-LOND-NEWC\",\"distance\":15.2,\"duration\":1682.1},{\"id\":\"GB-LOND-ELEP\",\"distance\":15.42,\"duration\":1736.8},{\"id\":\"GB-LOND-WALW\",\"distance\":15.74,\"duration\":1774.5},{\"id\":\"GB-ELTH-WEST\",\"distance\":16.05,\"duration\":1589.5},{\"id\":\"NWI\",\"distance\":182.26,\"duration\":8559},{\"id\":\"BOH\",\"distance\":184.99,\"duration\":9752},{\"id\":\"GB-LOND-VICT\",\"distance\":19.09,\"duration\":2296.8},{\"id\":\"GB-LOND-MARB\",\"distance\":19.42,\"duration\":2309.1},{\"id\":\"GB-LOND-MAR0\",\"distance\":19.48,\"duration\":2324.9},{\"id\":\"GB-LOND-LON2\",\"distance\":20.29,\"duration\":2355.3},{\"id\":\"BHX\",\"distance\":207.39,\"duration\":9303.9},{\"id\":\"EMA\",\"distance\":214.23,\"duration\":9341},{\"id\":\"GB-LOND-BISH\",\"distance\":21.49,\"duration\":2466.4},{\"id\":\"GB-LOND-STJO\",\"distance\":21.58,\"duration\":2493.3},{\"id\":\"BRS\",\"distance\":221.29,\"duration\":11678.4},{\"id\":\"GB-LOND-FINC\",\"distance\":23.69,\"duration\":2707.5},{\"id\":\"GB-LOND-HAMM\",\"distance\":24.25,\"duration\":2799.7},{\"id\":\"GB-LOND-WAND\",\"distance\":24.8,\"duration\":2710.1},{\"id\":\"GB-GRAV-BLUE\",\"distance\":29.93,\"duration\":2093.6},{\"id\":\"GB-LOND-LON3\",\"distance\":33.24,\"duration\":2420.9},{\"id\":\"GB-LOND-FIN0\",\"distance\":36.04,\"duration\":2697.5},{\"id\":\"GB-WATF-LOND\",\"distance\":39.13,\"duration\":2740.5},{\"id\":\"LHR\",\"distance\":44.88,\"duration\":4147.9},{\"id\":\"STN\",\"distance\":54.42,\"duration\":3212.4},{\"id\":\"SEN\",\"distance\":55.62,\"duration\":3265.4},{\"id\":\"LTN\",\"distance\":82.58,\"duration\":4135.6},{\"id\":\"LGW\",\"distance\":84.44,\"duration\":4316.5}],\"tags\":[{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"famous cities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1}],\"providers\":[1175,1277,1284],\"special\":[{\"id\":\"portsea-island_poi\",\"name\":\"Portsea Island\",\"slug\":\"portsea-island\"},{\"id\":\"stonehenge_poi\",\"name\":\"Stonehenge\",\"slug\":\"stonehenge\"},{\"id\":\"british-museum_poi\",\"name\":\"British Museum\",\"slug\":\"british-museum\"},{\"id\":\"natural-history-museum_poi\",\"name\":\"Natural History Museum\",\"slug\":\"natural-history-museum\"},{\"id\":\"st-paul-s-cathedral_poi\",\"name\":\"St. Paul's Cathedral\",\"slug\":\"st-paul-s-cathedral\"},{\"id\":\"tate-modern_poi\",\"name\":\"Tate Modern\",\"slug\":\"tate-modern\"},{\"id\":\"avebury_poi\",\"name\":\"Avebury\",\"slug\":\"avebury\"},{\"id\":\"canterbury-cathedral_poi\",\"name\":\"Canterbury Cathedral\",\"slug\":\"canterbury-cathedral\"},{\"id\":\"tower-of-london_poi\",\"name\":\"Tower of London\",\"slug\":\"tower-of-london\"},{\"id\":\"isle-of-wight_poi\",\"name\":\"Isle of Wight\",\"slug\":\"isle-of-wight\"}],\"tourist_region\":[{\"id\":\"greater-london_poi\",\"name\":\"Greater London\",\"slug\":\"greater-london\"}],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"245314\",\"164389\",\"4397519\"]}],\"new_ground\":false,\"routing_priority\":0,\"type\":\"airport\"},{\"id\":\"ELS\",\"int_id\":8592,\"airport_int_id\":8592,\"active\":true,\"code\":\"ELS\",\"icao\":\"FAEL\",\"name\":\"East London\",\"slug\":\"east-london-east-london-south-africa\",\"slug_en\":\"east-london-east-london-south-africa\",\"alternative_names\":[],\"rank\":639,\"global_rank_dst\":350,\"dst_popularity_score\":28175.0,\"timezone\":\"Africa\\/Johannesburg\",\"city\":{\"id\":\"east-london_za\",\"name\":\"East London\",\"code\":\"ELS\",\"slug\":\"east-london-south-africa\",\"subdivision\":null,\"continent\":{\"id\":\"africa\",\"name\":\"Africa\",\"slug\":\"africa\",\"code\":\"AF\"},\"region\":{\"id\":\"southern-africa\",\"name\":\"Southern Africa\",\"slug\":\"southern-africa\"},\"autonomous_territory\":null,\"country\":{\"id\":\"ZA\",\"name\":\"South Africa\",\"slug\":\"south-africa\",\"code\":\"ZA\"},\"nearby_country\":null},\"location\":{\"lat\":-33.035556,\"lon\":27.825833},\"alternative_departure_points\":[{\"id\":\"UTT\",\"distance\":242.01,\"duration\":11464.4}],\"tags\":[{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"family fun\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1}],\"providers\":[1175],\"special\":[],\"tourist_region\":[],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"19090\",\"657418\"]}],\"new_ground\":false,\"routing_priority\":0,\"type\":\"airport\"},{\"id\":\"SEN\",\"int_id\":8261,\"airport_int_id\":8261,\"active\":true,\"code\":\"SEN\",\"icao\":\"EGMC\",\"name\":\"London Southend\",\"slug\":\"london-southend-london-united-kingdom\",\"slug_en\":\"london-southend-london-united-kingdom\",\"alternative_names\":[],\"rank\":800,\"global_rank_dst\":695,\"dst_popularity_score\":14459.0,\"timezone\":\"Europe\\/London\",\"city\":{\"id\":\"london_gb\",\"name\":\"London\",\"code\":\"LON\",\"slug\":\"london-united-kingdom\",\"subdivision\":null,\"continent\":{\"id\":\"europe\",\"name\":\"Europe\",\"slug\":\"europe\",\"code\":\"EU\"},\"region\":{\"id\":\"northern-europe\",\"name\":\"Northern Europe\",\"slug\":\"northern-europe\"},\"autonomous_territory\":null,\"country\":{\"id\":\"GB\",\"name\":\"United Kingdom\",\"slug\":\"united-kingdom\",\"code\":\"GB\"},\"nearby_country\":null},\"location\":{\"lat\":51.571389,\"lon\":0.695556},\"alternative_departure_points\":[{\"id\":\"LGW\",\"distance\":100.55,\"duration\":4753.8},{\"id\":\"LTN\",\"distance\":106.06,\"duration\":4929.7},{\"id\":\"LHR\",\"distance\":123.42,\"duration\":5786},{\"id\":\"NWI\",\"distance\":163.69,\"duration\":8463.6},{\"id\":\"SOU\",\"distance\":207.09,\"duration\":8967.1},{\"id\":\"BHX\",\"distance\":230.87,\"duration\":10098},{\"id\":\"EMA\",\"distance\":237.71,\"duration\":10135.1},{\"id\":\"BOH\",\"distance\":248.94,\"duration\":10767},{\"id\":\"GB-GRAV-BLUE\",\"distance\":46.03,\"duration\":2530.9},{\"id\":\"LCY\",\"distance\":56.84,\"duration\":3209.3},{\"id\":\"STN\",\"distance\":67.45,\"duration\":3831.5}],\"tags\":[{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"famous cities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1}],\"providers\":[1165,1175,1277,1284],\"special\":[{\"id\":\"st-paul-s-cathedral_poi\",\"name\":\"St. Paul's Cathedral\",\"slug\":\"st-paul-s-cathedral\"},{\"id\":\"isle-of-wight_poi\",\"name\":\"Isle of Wight\",\"slug\":\"isle-of-wight\"},{\"id\":\"natural-history-museum_poi\",\"name\":\"Natural History Museum\",\"slug\":\"natural-history-museum\"},{\"id\":\"british-museum_poi\",\"name\":\"British Museum\",\"slug\":\"british-museum\"},{\"id\":\"tate-modern_poi\",\"name\":\"Tate Modern\",\"slug\":\"tate-modern\"},{\"id\":\"canterbury-cathedral_poi\",\"name\":\"Canterbury Cathedral\",\"slug\":\"canterbury-cathedral\"},{\"id\":\"portsea-island_poi\",\"name\":\"Portsea Island\",\"slug\":\"portsea-island\"},{\"id\":\"tower-of-london_poi\",\"name\":\"Tower of London\",\"slug\":\"tower-of-london\"}],\"tourist_region\":[{\"id\":\"greater-london_poi\",\"name\":\"Greater London\",\"slug\":\"greater-london\"}],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"679308\"]}],\"new_ground\":false,\"routing_priority\":0,\"type\":\"airport\"},{\"id\":\"YXU\",\"int_id\":6803,\"airport_int_id\":6803,\"active\":true,\"code\":\"YXU\",\"icao\":\"CYXU\",\"name\":\"London International\",\"slug\":\"london-international-london-ontario-canada\",\"slug_en\":\"london-international-london-ontario-canada\",\"alternative_names\":[],\"rank\":947,\"global_rank_dst\":332,\"dst_popularity_score\":39422.0,\"timezone\":\"America\\/Toronto\",\"city\":{\"id\":\"london_on_ca\",\"name\":\"London\",\"code\":\"YXU\",\"slug\":\"london-ontario-canada\",\"subdivision\":{\"id\":\"ON_CA\",\"name\":\"Ontario\",\"slug\":\"ontario-canada\",\"code\":\"ON\"},\"continent\":{\"id\":\"north-america\",\"name\":\"North America\",\"slug\":\"north-america\",\"code\":\"NA\"},\"region\":{\"id\":\"northern-america\",\"name\":\"Northern America\",\"slug\":\"northern-america\"},\"autonomous_territory\":null,\"country\":{\"id\":\"CA\",\"name\":\"Canada\",\"slug\":\"canada\",\"code\":\"CA\"},\"nearby_country\":null},\"location\":{\"lat\":43.035556,\"lon\":-81.153889},\"alternative_departure_points\":[{\"id\":\"YKF\",\"distance\":105.15,\"duration\":5377.4},{\"id\":\"CA-LOND-TRAI\",\"distance\":11.81,\"duration\":1098.4},{\"id\":\"YHM\",\"distance\":122.92,\"duration\":5989.6},{\"id\":\"YYZ\",\"distance\":170.28,\"duration\":8330.9},{\"id\":\"YTZ\",\"distance\":187.86,\"duration\":9151.9},{\"id\":\"YQG\",\"distance\":194.1,\"duration\":9177.1},{\"id\":\"IAG\",\"distance\":209.79,\"duration\":10041.5},{\"id\":\"BUF\",\"distance\":242.75,\"duration\":11728.2},{\"id\":\"FNT\",\"distance\":245.77,\"duration\":11210.9},{\"id\":\"CA-INGE-TRAI\",\"distance\":26.19,\"duration\":1836.6},{\"id\":\"CA-STMA-TRAI\",\"distance\":33.41,\"duration\":2243.2},{\"id\":\"CA-WOOD-TRAI\",\"distance\":38.06,\"duration\":2545.7}],\"tags\":[{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"family fun\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1}],\"providers\":[1175,1277],\"special\":[],\"tourist_region\":[],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"389436\",\"4127\",\"4309372\",\"1314023\"]}],\"new_ground\":false,\"routing_priority\":0,\"type\":\"airport\"}],\"meta\":{\"locale\":{\"code\":\"en-US\",\"status\":\"Locale not specified, using default.\"}},\"last_refresh\":1659522371,\"results_retrieved\":7}";
    private final String testCitySearchJsonResponse = "{\"locations\":[{\"id\":\"london_gb\",\"active\":true,\"name\":\"London\",\"slug\":\"london-united-kingdom\",\"slug_en\":\"london-united-kingdom\",\"code\":\"LON\",\"alternative_names\":[],\"rank\":2,\"global_rank_dst\":1,\"dst_popularity_score\":6722452.0,\"timezone\":\"Europe\\/London\",\"population\":7556900,\"airports\":6,\"stations\":5,\"hotels\":8104,\"bus_stations\":25,\"subdivision\":null,\"autonomous_territory\":null,\"country\":{\"id\":\"GB\",\"name\":\"United Kingdom\",\"slug\":\"united-kingdom\",\"code\":\"GB\"},\"region\":{\"id\":\"northern-europe\",\"name\":\"Northern Europe\",\"slug\":\"northern-europe\"},\"continent\":{\"id\":\"europe\",\"name\":\"Europe\",\"slug\":\"europe\",\"code\":\"EU\"},\"nearby_country\":null,\"location\":{\"lat\":51.507351,\"lon\":-0.127758},\"tags\":[{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"famous cities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1}],\"alternative_departure_points\":[{\"id\":\"GB-PORT-PORT\",\"distance\":119.44,\"duration\":5819.1},{\"id\":\"GB-PORT-POR1\",\"distance\":121.96,\"duration\":6077.1},{\"id\":\"SOU\",\"distance\":126.37,\"duration\":5872.3},{\"id\":\"GB-SOUT-SOUT\",\"distance\":128.98,\"duration\":6184.1},{\"id\":\"XWS\",\"distance\":130.31,\"duration\":6231.6},{\"id\":\"LCY\",\"distance\":14.37,\"duration\":1515.8},{\"id\":\"GB-COVE-COVE\",\"distance\":153.9,\"duration\":7183.6},{\"id\":\"BOH\",\"distance\":167.95,\"duration\":7508.1},{\"id\":\"BHX\",\"distance\":172.56,\"duration\":8419.1},{\"id\":\"FR-CALA-CALA\",\"distance\":172.95,\"duration\":11475.8},{\"id\":\"GB-BATH-BATH\",\"distance\":176.49,\"duration\":8201.3},{\"id\":\"QQX\",\"distance\":178.86,\"duration\":8512.5},{\"id\":\"GB-NORW-NORW\",\"distance\":184.06,\"duration\":8527.7},{\"id\":\"EMA\",\"distance\":186.33,\"duration\":8360.3},{\"id\":\"GB-BRIS-BRIS\",\"distance\":189.34,\"duration\":8462.1},{\"id\":\"QQN\",\"distance\":191.75,\"duration\":8840},{\"id\":\"GB-BIRM-BIRM\",\"distance\":192.76,\"duration\":8929.7},{\"id\":\"NWI\",\"distance\":203.23,\"duration\":9043.3},{\"id\":\"BRS\",\"distance\":203.91,\"duration\":9702.4},{\"id\":\"XNM\",\"distance\":204.09,\"duration\":9280.9},{\"id\":\"FR-DUNK-DUN0\",\"distance\":215.1,\"duration\":13326.4},{\"id\":\"FR-DUNK-DUNK\",\"distance\":218.62,\"duration\":13527.1},{\"id\":\"XNE\",\"distance\":220.73,\"duration\":9696},{\"id\":\"ZMA\",\"distance\":225.52,\"duration\":10114.4},{\"id\":\"ZFI\",\"distance\":238.96,\"duration\":10350.9},{\"id\":\"GB-CARD-CAR1\",\"distance\":240.7,\"duration\":10628.6},{\"id\":\"GB-CARD-CARD\",\"distance\":240.76,\"duration\":10526.6},{\"id\":\"GB-CARD-CAR0\",\"distance\":242.1,\"duration\":10787.8},{\"id\":\"ZEP\",\"distance\":2.44,\"duration\":259.2},{\"id\":\"ZFG\",\"distance\":258.23,\"duration\":11595.2},{\"id\":\"CWL\",\"distance\":265.48,\"duration\":11880.8},{\"id\":\"EXT\",\"distance\":272.71,\"duration\":12458},{\"id\":\"GB-EXET-EXET\",\"distance\":274.18,\"duration\":12478.9},{\"id\":\"DSA\",\"distance\":274.25,\"duration\":12367.6},{\"id\":\"LHR\",\"distance\":28.29,\"duration\":2142.6},{\"id\":\"HUY\",\"distance\":299.21,\"duration\":13453.7},{\"id\":\"QQS\",\"distance\":3.54,\"duration\":450.2},{\"id\":\"ZLS\",\"distance\":4.6,\"duration\":637.2},{\"id\":\"QQP\",\"distance\":4.97,\"duration\":525.4},{\"id\":\"LGW\",\"distance\":50.21,\"duration\":3719.8},{\"id\":\"LTN\",\"distance\":56.7,\"duration\":3648.8},{\"id\":\"STN\",\"distance\":62.07,\"duration\":3775.7},{\"id\":\"SEN\",\"distance\":66.38,\"duration\":3977.3},{\"id\":\"XRE\",\"distance\":67.35,\"duration\":3716.3},{\"id\":\"ZFH\",\"distance\":82.09,\"duration\":4081.8},{\"id\":\"XQB\",\"distance\":82.72,\"duration\":4110},{\"id\":\"GB-BRIG-BRIG\",\"distance\":84.24,\"duration\":5131.5},{\"id\":\"GB-OXFO-OXF0\",\"distance\":84.87,\"duration\":4193.3},{\"id\":\"GB-BRIG-BRI0\",\"distance\":86.02,\"duration\":5375.6},{\"id\":\"GB-CAMB-CAM1\",\"distance\":91.46,\"duration\":4542.7},{\"id\":\"GB-OXFO-OXFO\",\"distance\":94.04,\"duration\":4964.2},{\"id\":\"GB-CAMB-CAM2\",\"distance\":96.04,\"duration\":4983}],\"providers\":[1028,1035,1053,1096,1148,1163,1165,1175,1224,1227,1229,1277,1282,1283,1284,1329],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"435598\",\"4219166\",\"435613\",\"435763\",\"292504\",\"245304\",\"164574\",\"4343811\",\"4435087\",\"4284212\",\"245299\",\"164379\",\"4263809\",\"245309\",\"515988\",\"164754\",\"245314\",\"164389\",\"4397519\",\"1266273\",\"3798861\",\"4369995\",\"1389911\",\"553353\",\"679308\",\"3373006\",\"4125656\",\"1558798\",\"3926043\"]},{\"provider_id\":1175,\"providers_locations\":[\"3833986\",\"3372796\",\"4095663\",\"3372801\",\"435593\",\"336936\",\"4095669\",\"3598098\",\"435573\",\"1389971\",\"435588\",\"4095674\",\"4023721\",\"245289\",\"2401846\",\"2022713\",\"956598\",\"336986\",\"1641043\",\"285774\",\"336991\",\"435578\",\"3373021\",\"1389901\",\"1558998\",\"286054\",\"336901\",\"285954\",\"4142488\",\"3666206\",\"3797801\",\"3929717\",\"1389871\"]}],\"type\":\"city\"},{\"id\":\"london_on_ca\",\"active\":true,\"name\":\"London\",\"slug\":\"london-ontario-canada\",\"slug_en\":\"london-ontario-canada\",\"code\":\"YXU\",\"alternative_names\":[],\"rank\":1087,\"global_rank_dst\":370,\"dst_popularity_score\":39481.0,\"timezone\":\"America\\/Toronto\",\"population\":346765,\"airports\":1,\"stations\":1,\"hotels\":0,\"bus_stations\":0,\"subdivision\":{\"id\":\"ON_CA\",\"name\":\"Ontario\",\"slug\":\"ontario-canada\",\"code\":\"ON\"},\"autonomous_territory\":null,\"country\":{\"id\":\"CA\",\"name\":\"Canada\",\"slug\":\"canada\",\"code\":\"CA\"},\"region\":{\"id\":\"northern-america\",\"name\":\"Northern America\",\"slug\":\"northern-america\"},\"continent\":{\"id\":\"north-america\",\"name\":\"North America\",\"slug\":\"north-america\",\"code\":\"NA\"},\"nearby_country\":null,\"location\":{\"lat\":42.98695,\"lon\":-81.243177},\"tags\":[{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"family fun\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1}],\"alternative_departure_points\":[{\"id\":\"YKF\",\"distance\":107.96,\"duration\":5371.8},{\"id\":\"YXU\",\"distance\":11.62,\"duration\":931.8},{\"id\":\"YHM\",\"distance\":125.63,\"duration\":5992.1},{\"id\":\"YYZ\",\"distance\":172.98,\"duration\":8451.7},{\"id\":\"YQG\",\"distance\":182.89,\"duration\":8631.2},{\"id\":\"YTZ\",\"distance\":191.44,\"duration\":9136.4},{\"id\":\"IAG\",\"distance\":212.33,\"duration\":10165.1},{\"id\":\"FNT\",\"distance\":220.12,\"duration\":10335.6},{\"id\":\"DTW\",\"distance\":229.75,\"duration\":11005.8},{\"id\":\"BUF\",\"distance\":245.03,\"duration\":11859},{\"id\":\"MBS\",\"distance\":291.95,\"duration\":13933}],\"providers\":[1096,1161,1162,1175,1217,1277,1282,1283],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"389436\",\"4127\",\"4309372\",\"1314023\"]}],\"type\":\"city\"},{\"id\":\"east-london_za\",\"active\":true,\"name\":\"East London\",\"slug\":\"east-london-south-africa\",\"slug_en\":\"east-london-south-africa\",\"code\":\"ELS\",\"alternative_names\":[],\"rank\":959,\"global_rank_dst\":389,\"dst_popularity_score\":28175.0,\"timezone\":\"Africa\\/Johannesburg\",\"population\":478676,\"airports\":1,\"stations\":0,\"hotels\":0,\"bus_stations\":0,\"subdivision\":null,\"autonomous_territory\":null,\"country\":{\"id\":\"ZA\",\"name\":\"South Africa\",\"slug\":\"south-africa\",\"code\":\"ZA\"},\"region\":{\"id\":\"southern-africa\",\"name\":\"Southern Africa\",\"slug\":\"southern-africa\"},\"continent\":{\"id\":\"africa\",\"name\":\"Africa\",\"slug\":\"africa\",\"code\":\"AF\"},\"nearby_country\":null,\"location\":{\"lat\":-33.029158,\"lon\":27.854587},\"tags\":[{\"tag\":\"activities\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"city break\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"events\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"family fun\",\"month_to\":-1,\"month_from\":-1},{\"tag\":\"sightseeing\",\"month_to\":-1,\"month_from\":-1}],\"alternative_departure_points\":[{\"id\":\"UTT\",\"distance\":237.97,\"duration\":10601.2},{\"id\":\"ELS\",\"distance\":5.55,\"duration\":737.6}],\"providers\":[1175],\"car_rentals\":[{\"provider_id\":1175,\"providers_locations\":[\"19090\",\"657418\"]}],\"type\":\"city\"},{\"id\":\"london_ky_us\",\"active\":true,\"name\":\"London\",\"slug\":\"london-kentucky-united-states\",\"slug_en\":\"london-kentucky-united-states\",\"code\":null,\"alternative_names\":[],\"rank\":2048,\"global_rank_dst\":2048,\"dst_popularity_score\":218.0,\"timezone\":\"America\\/New_York\",\"population\":null,\"airports\":0,\"stations\":0,\"hotels\":11,\"bus_stations\":1,\"subdivision\":{\"id\":\"KY_US\",\"name\":\"Kentucky\",\"slug\":\"kentucky-united-states\",\"code\":\"KY\"},\"autonomous_territory\":null,\"country\":{\"id\":\"US\",\"name\":\"United States\",\"slug\":\"united-states\",\"code\":\"US\"},\"region\":{\"id\":\"northern-america\",\"name\":\"Northern America\",\"slug\":\"northern-america\"},\"continent\":{\"id\":\"north-america\",\"name\":\"North America\",\"slug\":\"north-america\",\"code\":\"NA\"},\"nearby_country\":null,\"location\":{\"lat\":37.128904,\"lon\":-84.083292},\"tags\":[],\"alternative_departure_points\":[{\"id\":\"LEX\",\"distance\":131.75,\"duration\":5911.3},{\"id\":\"TYS\",\"distance\":176.64,\"duration\":7763.7},{\"id\":\"SDF\",\"distance\":224.17,\"duration\":10010.5},{\"id\":\"CVG\",\"distance\":243.52,\"duration\":10403.8},{\"id\":\"TRI\",\"distance\":249.36,\"duration\":10973.4},{\"id\":\"HTS\",\"distance\":273.11,\"duration\":11401.8}],\"providers\":[1161,1277],\"car_rentals\":[],\"type\":\"city\"},{\"id\":\"londonderry_nh_us\",\"active\":true,\"name\":\"Londonderry\",\"slug\":\"londonderry-new-hampshire-united-states\",\"slug_en\":\"londonderry-new-hampshire-united-states\",\"code\":null,\"alternative_names\":[],\"rank\":2048,\"global_rank_dst\":2048,\"dst_popularity_score\":0.0,\"timezone\":\"America\\/New_York\",\"population\":null,\"airports\":0,\"stations\":0,\"hotels\":2,\"bus_stations\":1,\"subdivision\":{\"id\":\"NH_US\",\"name\":\"New Hampshire\",\"slug\":\"new-hampshire-united-states\",\"code\":\"NH\"},\"autonomous_territory\":null,\"country\":{\"id\":\"US\",\"name\":\"United States\",\"slug\":\"united-states\",\"code\":\"US\"},\"region\":{\"id\":\"northern-america\",\"name\":\"Northern America\",\"slug\":\"northern-america\"},\"continent\":{\"id\":\"north-america\",\"name\":\"North America\",\"slug\":\"north-america\",\"code\":\"NA\"},\"nearby_country\":null,\"location\":{\"lat\":42.865008,\"lon\":-71.374391},\"tags\":[],\"alternative_departure_points\":[{\"id\":\"MHT\",\"distance\":12.93,\"duration\":1179.2},{\"id\":\"LEB\",\"distance\":139.2,\"duration\":6561.9},{\"id\":\"PVD\",\"distance\":152.15,\"duration\":8159.7},{\"id\":\"EWB\",\"distance\":161.2,\"duration\":7950.5},{\"id\":\"PWM\",\"distance\":161.34,\"duration\":7435.7},{\"id\":\"HYA\",\"distance\":185.47,\"duration\":9504.9},{\"id\":\"BDL\",\"distance\":191.98,\"duration\":10532.1},{\"id\":\"ZRT\",\"distance\":193.37,\"duration\":9610.3},{\"id\":\"RUT\",\"distance\":198.89,\"duration\":11005.4},{\"id\":\"ZVE\",\"distance\":249.2,\"duration\":12248.9},{\"id\":\"AUG\",\"distance\":251.99,\"duration\":11073.1},{\"id\":\"ALB\",\"distance\":255.46,\"duration\":14053.8},{\"id\":\"PVC\",\"distance\":261.19,\"duration\":13888},{\"id\":\"BTV\",\"distance\":279.71,\"duration\":12628.1},{\"id\":\"RKD\",\"distance\":297.23,\"duration\":13877.3},{\"id\":\"ZTO\",\"distance\":74.81,\"duration\":4074.3},{\"id\":\"BOS\",\"distance\":76.7,\"duration\":4140.3},{\"id\":\"PSM\",\"distance\":79.79,\"duration\":4605.7},{\"id\":\"ORH\",\"distance\":99.36,\"duration\":5640.2}],\"providers\":[1277],\"car_rentals\":[],\"type\":\"city\"},{\"id\":\"new-london_ct_us\",\"active\":true,\"name\":\"New London\",\"slug\":\"new-london-connecticut-united-states\",\"slug_en\":\"new-london-connecticut-united-states\",\"code\":null,\"alternative_names\":[],\"rank\":2048,\"global_rank_dst\":2048,\"dst_popularity_score\":7.0,\"timezone\":\"America\\/New_York\",\"population\":null,\"airports\":0,\"stations\":1,\"hotels\":0,\"bus_stations\":0,\"subdivision\":{\"id\":\"CT_US\",\"name\":\"Connecticut\",\"slug\":\"connecticut-united-states\",\"code\":\"CT\"},\"autonomous_territory\":null,\"country\":{\"id\":\"US\",\"name\":\"United States\",\"slug\":\"united-states\",\"code\":\"US\"},\"region\":{\"id\":\"northern-america\",\"name\":\"Northern America\",\"slug\":\"northern-america\"},\"continent\":{\"id\":\"north-america\",\"name\":\"North America\",\"slug\":\"north-america\",\"code\":\"NA\"},\"nearby_country\":null,\"location\":{\"lat\":41.355656,\"lon\":-72.099518},\"tags\":[],\"alternative_departure_points\":[],\"providers\":[1161,1162,1277],\"car_rentals\":[],\"type\":\"city\"}],\"meta\":{\"locale\":{\"code\":\"en-US\",\"status\":\"Locale not specified, using default.\"}},\"last_refresh\":1659522371,\"results_retrieved\":6}";
    private final String testFlightSearchJsonResponse = "{\"search_id\": \"a5fc0797-81ee-20ef-0e6b-83568713cf5a\", \"currency\": \"GBP\", \"fx_rate\": 0.836794, \"data\": [{\"id\": \"0f6425c34b144b294add7d64_0|0f6425c34b144b294add7d64_1\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"countryFrom\": {\"code\": \"GB\", \"name\": \"United Kingdom\"}, \"countryTo\": {\"code\": \"FR\", \"name\": \"France\"}, \"nightsInDest\": null, \"quality\": 468.415504, \"distance\": 348.3, \"duration\": {\"departure\": 4800, \"return\": 0, \"total\": 4800}, \"price\": 373, \"conversion\": {\"EUR\": 445.748894, \"GBP\": 373}, \"fare\": {\"adults\": 373, \"children\": 373, \"infants\": 373}, \"bags_price\": {\"1\": 114}, \"baglimit\": {\"hand_height\": 45, \"hand_length\": 56, \"hand_weight\": 23, \"hand_width\": 25, \"hold_dimensions_sum\": 208, \"hold_height\": 75, \"hold_length\": 90, \"hold_weight\": 23, \"hold_width\": 43, \"personal_item_height\": 30, \"personal_item_length\": 40, \"personal_item_weight\": 23, \"personal_item_width\": 15}, \"availability\": {\"seats\": null}, \"airlines\": [\"BA\"], \"route\": [{\"id\": \"0f6425c34b144b294add7d64_0\", \"combination_id\": \"0f6425c34b144b294add7d64\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"airline\": \"BA\", \"flight_no\": 308, \"operating_carrier\": \"BA\", \"operating_flight_no\": \"308\", \"fare_basis\": \"\", \"fare_category\": \"M\", \"fare_classes\": \"B\", \"fare_family\": \"\", \"return\": 0, \"bags_recheck_required\": false, \"vi_connection\": false, \"guarantee\": false, \"equipment\": null, \"vehicle_type\": \"aircraft\", \"local_arrival\": \"2022-08-16T13:20:00.000Z\", \"utc_arrival\": \"2022-08-16T11:20:00.000Z\", \"local_departure\": \"2022-08-16T11:00:00.000Z\", \"utc_departure\": \"2022-08-16T10:00:00.000Z\"}], \"booking_token\": \"EMWWgV4pXh1vC_DuHWAzcQkNuTSFh5XecA13t4WBOO4tG3FUoDy1lsuNrF_CjbQGorv9p0cS2ROMt35den8JZN8oAeUyIOnx9cilhB2Ji9UDQR4X8sePN0nsziTW_iK7hwc0NdLW2vTudeDAAcLJjAmf9f5oJ_Yuor3PL6EtlFqmJudKFlS_CUn_xcLrhYCCv_uQ9LrI0JekuAzYeWb6Yxs8MizeP70d84T0JJzoTAN8-z3AcOXR3RQSO7z_0w76CRanAYrN6IwjwSX9tthLtxEW7Ai3iqT_KbUI9MyB4DIEYbdOmMDblo_hyRYDljKAKhLKhwzqT6elntE8s9lVWCFv64q5Fl3LXnT4yTKhAo8S6oRol7KoCXZawsT8W3MqIY6gLV743tJLztlsI9BZ354WlzqWbv-27L-hcytTgQmg00Uv4mzBMZyqKoKWq1r-Y\", \"deep_link\": \"https://www.kiwi.com/deep?affilid=olliecroysdillgoyourway&currency=GBP&flightsId=0f6425c34b144b294add7d64_0%7C0f6425c34b144b294add7d64_1&from=LHR&lang=en&passengers=1&to=CDG&booking_token=EMWWgV4pXh1vC_DuHWAzcQkNuTSFh5XecA13t4WBOO4tG3FUoDy1lsuNrF_CjbQGorv9p0cS2ROMt35den8JZN8oAeUyIOnx9cilhB2Ji9UDQR4X8sePN0nsziTW_iK7hwc0NdLW2vTudeDAAcLJjAmf9f5oJ_Yuor3PL6EtlFqmJudKFlS_CUn_xcLrhYCCv_uQ9LrI0JekuAzYeWb6Yxs8MizeP70d84T0JJzoTAN8-z3AcOXR3RQSO7z_0w76CRanAYrN6IwjwSX9tthLtxEW7Ai3iqT_KbUI9MyB4DIEYbdOmMDblo_hyRYDljKAKhLKhwzqT6elntE8s9lVWCFv64q5Fl3LXnT4yTKhAo8S6oRol7KoCXZawsT8W3MqIY6gLV743tJLztlsI9BZ354WlzqWbv-27L-hcytTgQmg00Uv4mzBMZyqKoKWq1r-Y\", \"facilitated_booking_available\": true, \"pnr_count\": 1, \"has_airport_change\": false, \"technical_stops\": 0, \"throw_away_ticketing\": true, \"hidden_city_ticketing\": false, \"virtual_interlining\": false, \"local_arrival\": \"2022-08-16T13:20:00.000Z\", \"utc_arrival\": \"2022-08-16T11:20:00.000Z\", \"local_departure\": \"2022-08-16T11:00:00.000Z\", \"utc_departure\": \"2022-08-16T10:00:00.000Z\"}, {\"id\": \"0f6425c34b14000037a4857e_0\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"countryFrom\": {\"code\": \"GB\", \"name\": \"United Kingdom\"}, \"countryTo\": {\"code\": \"FR\", \"name\": \"France\"}, \"nightsInDest\": null, \"quality\": 555.653223, \"distance\": 348.3, \"duration\": {\"departure\": 4800, \"return\": 0, \"total\": 4800}, \"price\": 446, \"conversion\": {\"EUR\": 532.986613, \"GBP\": 446}, \"fare\": {\"adults\": 446, \"children\": 446, \"infants\": 446}, \"bags_price\": {\"1\": 57}, \"baglimit\": {\"hand_height\": 45, \"hand_length\": 56, \"hand_weight\": 23, \"hand_width\": 25, \"hold_dimensions_sum\": 208, \"hold_height\": 75, \"hold_length\": 90, \"hold_weight\": 23, \"hold_width\": 43, \"personal_item_height\": 30, \"personal_item_length\": 40, \"personal_item_weight\": 23, \"personal_item_width\": 15}, \"availability\": {\"seats\": null}, \"airlines\": [\"BA\"], \"route\": [{\"id\": \"0f6425c34b14000037a4857e_0\", \"combination_id\": \"0f6425c34b14000037a4857e\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"airline\": \"BA\", \"flight_no\": 308, \"operating_carrier\": \"BA\", \"operating_flight_no\": \"308\", \"fare_basis\": \"\", \"fare_category\": \"M\", \"fare_classes\": \"B\", \"fare_family\": \"\", \"return\": 0, \"bags_recheck_required\": false, \"vi_connection\": false, \"guarantee\": false, \"equipment\": null, \"vehicle_type\": \"aircraft\", \"local_arrival\": \"2022-08-16T13:20:00.000Z\", \"utc_arrival\": \"2022-08-16T11:20:00.000Z\", \"local_departure\": \"2022-08-16T11:00:00.000Z\", \"utc_departure\": \"2022-08-16T10:00:00.000Z\"}], \"booking_token\": \"EsUUxMGpRez4EhuRIouk8A-PzmdHz8KFueyyiAGnKaRYMtTeWW78GfvO9zjbgPHhPe6WFNx1_zARsUEKOCOJ7gmBEnshzy6dljnXgkvIZVJ04gOtFNYLHEtJIBfNieowcSiK06AgDneg2C7SXfRYdDG6xQZYcLt9-PMs1-8aN07SepEhx_lfVo-wjP9iQz3TXsDRqEaWbr1zBIfu_tiATiDOvuQJihPWdNFDAniiTDscIfT6Zzei6PQmGDivbECWYV-2i-1eDYAt-j-__HmhGTN4vTV10lda0Hf80csjp1kE2tNalxXfHSdc0kJVOTpTVsgbGiAMD_DUIir5t7XKXZYCdls9deiDjkckMvepYr0NhOd1jbBbs6hsIEBXQYYzWAVQnEaT1SxldxbJeEU2zrQ==\", \"deep_link\": \"https://www.kiwi.com/deep?affilid=olliecroysdillgoyourway&currency=GBP&flightsId=0f6425c34b14000037a4857e_0&from=LHR&lang=en&passengers=1&to=CDG&booking_token=EsUUxMGpRez4EhuRIouk8A-PzmdHz8KFueyyiAGnKaRYMtTeWW78GfvO9zjbgPHhPe6WFNx1_zARsUEKOCOJ7gmBEnshzy6dljnXgkvIZVJ04gOtFNYLHEtJIBfNieowcSiK06AgDneg2C7SXfRYdDG6xQZYcLt9-PMs1-8aN07SepEhx_lfVo-wjP9iQz3TXsDRqEaWbr1zBIfu_tiATiDOvuQJihPWdNFDAniiTDscIfT6Zzei6PQmGDivbECWYV-2i-1eDYAt-j-__HmhGTN4vTV10lda0Hf80csjp1kE2tNalxXfHSdc0kJVOTpTVsgbGiAMD_DUIir5t7XKXZYCdls9deiDjkckMvepYr0NhOd1jbBbs6hsIEBXQYYzWAVQnEaT1SxldxbJeEU2zrQ==\", \"facilitated_booking_available\": true, \"pnr_count\": 1, \"has_airport_change\": false, \"technical_stops\": 0, \"throw_away_ticketing\": false, \"hidden_city_ticketing\": false, \"virtual_interlining\": false, \"local_arrival\": \"2022-08-16T13:20:00.000Z\", \"utc_arrival\": \"2022-08-16T11:20:00.000Z\", \"local_departure\": \"2022-08-16T11:00:00.000Z\", \"utc_departure\": \"2022-08-16T10:00:00.000Z\"}, {\"id\": \"0f6425c34b144b295712acc6_0|0f6425c34b144b295712acc6_1\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"countryFrom\": {\"code\": \"GB\", \"name\": \"United Kingdom\"}, \"countryTo\": {\"code\": \"FR\", \"name\": \"France\"}, \"nightsInDest\": null, \"quality\": 580.749005, \"distance\": 348.3, \"duration\": {\"departure\": 4800, \"return\": 0, \"total\": 4800}, \"price\": 467, \"conversion\": {\"EUR\": 558.082395, \"GBP\": 467}, \"fare\": {\"adults\": 467, \"children\": 467, \"infants\": 467}, \"bags_price\": {\"1\": 114}, \"baglimit\": {\"hand_height\": 45, \"hand_length\": 56, \"hand_weight\": 23, \"hand_width\": 25, \"hold_dimensions_sum\": 208, \"hold_height\": 75, \"hold_length\": 90, \"hold_weight\": 23, \"hold_width\": 43, \"personal_item_height\": 30, \"personal_item_length\": 40, \"personal_item_weight\": 23, \"personal_item_width\": 15}, \"availability\": {\"seats\": 1}, \"airlines\": [\"BA\"], \"route\": [{\"id\": \"0f6425c34b144b295712acc6_0\", \"combination_id\": \"0f6425c34b144b295712acc6\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"airline\": \"BA\", \"flight_no\": 328, \"operating_carrier\": \"BA\", \"operating_flight_no\": \"328\", \"fare_basis\": \"\", \"fare_category\": \"M\", \"fare_classes\": \"Y\", \"fare_family\": \"\", \"return\": 0, \"bags_recheck_required\": false, \"vi_connection\": false, \"guarantee\": false, \"equipment\": null, \"vehicle_type\": \"aircraft\", \"local_arrival\": \"2022-08-16T20:40:00.000Z\", \"utc_arrival\": \"2022-08-16T18:40:00.000Z\", \"local_departure\": \"2022-08-16T18:20:00.000Z\", \"utc_departure\": \"2022-08-16T17:20:00.000Z\"}], \"booking_token\": \"EdVG6BTPWe4-ReGV_jcbqC5X4ZA4KN-WUqLSu8OMkjtHU0Gtb7ZTpxORrHSqDZqs9mgRIRlXsQp81wnm_TwTgPlkwz1aNIhx6L8zmPM-X-2aAlYrr2X1i7Od03f0sKIUjFdp0IS0fJJ7nkEkmkUnLoV6BE5W8lBrNO2LA4JHbDRvT6__xfbJcYz-J158qa__w2zJVOjCAU0sGL8zf7vLR0VdIvhYM_wNa7zEnDr4bbzFzYxBPsSbVp650RK7GEVnNYTSSGH8cXv42v0rj_lGUwD0bHnCQ86qBasIqIrlXwKcS-bW4enq-rMb8Pc6nbhsg5aKvrzxI8YPbG0n4D1_ky68SfHKMbNQey8bE3BpPiz-xaJHvrEui8I5CWXdevMkrLfS3iZPdb27yb7aEThZ-Fg-BVObE1pBmhZiOLG29VzQ_-ULund6vKQK6lu_qrTSM\", \"deep_link\": \"https://www.kiwi.com/deep?affilid=olliecroysdillgoyourway&currency=GBP&flightsId=0f6425c34b144b295712acc6_0%7C0f6425c34b144b295712acc6_1&from=LHR&lang=en&passengers=1&to=CDG&booking_token=EdVG6BTPWe4-ReGV_jcbqC5X4ZA4KN-WUqLSu8OMkjtHU0Gtb7ZTpxORrHSqDZqs9mgRIRlXsQp81wnm_TwTgPlkwz1aNIhx6L8zmPM-X-2aAlYrr2X1i7Od03f0sKIUjFdp0IS0fJJ7nkEkmkUnLoV6BE5W8lBrNO2LA4JHbDRvT6__xfbJcYz-J158qa__w2zJVOjCAU0sGL8zf7vLR0VdIvhYM_wNa7zEnDr4bbzFzYxBPsSbVp650RK7GEVnNYTSSGH8cXv42v0rj_lGUwD0bHnCQ86qBasIqIrlXwKcS-bW4enq-rMb8Pc6nbhsg5aKvrzxI8YPbG0n4D1_ky68SfHKMbNQey8bE3BpPiz-xaJHvrEui8I5CWXdevMkrLfS3iZPdb27yb7aEThZ-Fg-BVObE1pBmhZiOLG29VzQ_-ULund6vKQK6lu_qrTSM\", \"facilitated_booking_available\": true, \"pnr_count\": 1, \"has_airport_change\": false, \"technical_stops\": 0, \"throw_away_ticketing\": true, \"hidden_city_ticketing\": false, \"virtual_interlining\": false, \"local_arrival\": \"2022-08-16T20:40:00.000Z\", \"utc_arrival\": \"2022-08-16T18:40:00.000Z\", \"local_departure\": \"2022-08-16T18:20:00.000Z\", \"utc_departure\": \"2022-08-16T17:20:00.000Z\"}, {\"id\": \"0f6425c34b154b2a3b499574_0|0f6425c34b154b2a3b499574_1\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"countryFrom\": {\"code\": \"GB\", \"name\": \"United Kingdom\"}, \"countryTo\": {\"code\": \"FR\", \"name\": \"France\"}, \"nightsInDest\": null, \"quality\": 580.749005, \"distance\": 348.3, \"duration\": {\"departure\": 4800, \"return\": 0, \"total\": 4800}, \"price\": 467, \"conversion\": {\"EUR\": 558.082395, \"GBP\": 467}, \"fare\": {\"adults\": 467, \"children\": 467, \"infants\": 467}, \"bags_price\": {\"1\": 114}, \"baglimit\": {\"hand_height\": 45, \"hand_length\": 56, \"hand_weight\": 23, \"hand_width\": 25, \"hold_dimensions_sum\": 208, \"hold_height\": 75, \"hold_length\": 90, \"hold_weight\": 23, \"hold_width\": 43, \"personal_item_height\": 30, \"personal_item_length\": 40, \"personal_item_weight\": 23, \"personal_item_width\": 15}, \"availability\": {\"seats\": 1}, \"airlines\": [\"BA\"], \"route\": [{\"id\": \"0f6425c34b154b2a3b499574_0\", \"combination_id\": \"0f6425c34b154b2a3b499574\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"airline\": \"BA\", \"flight_no\": 306, \"operating_carrier\": \"BA\", \"operating_flight_no\": \"306\", \"fare_basis\": \"\", \"fare_category\": \"M\", \"fare_classes\": \"Y\", \"fare_family\": \"\", \"return\": 0, \"bags_recheck_required\": false, \"vi_connection\": false, \"guarantee\": false, \"equipment\": null, \"vehicle_type\": \"aircraft\", \"local_arrival\": \"2022-08-17T11:15:00.000Z\", \"utc_arrival\": \"2022-08-17T09:15:00.000Z\", \"local_departure\": \"2022-08-17T08:55:00.000Z\", \"utc_departure\": \"2022-08-17T07:55:00.000Z\"}], \"booking_token\": \"EhXx47PEFKoS5nkLHYJDIv_2I5DmQ5DaPegGl6asIk4KM1L00ALMi_nde8sA6luFHY7ELF5fKR53nJl39m92O9_i_ZVduERgNgolm8AOPGIN3UuAui9_m3vE9MYyNmVsC3CxY9hUyqHH1MnzfyuV60zvdZzU6yMb07X_Cy_rszlRQtWihuPh9lLc-5ZhJ5bGtl1uBpef5TQcv9zogft3nB8IpC9P0NY_QKT6KFssCKT9Af_hSGf34HRP0lhD7dh3XGJLJcRC7YnqgIx2_npthUfAM4Q_gz3PVS52uIRhk61DWYLpRkrMTbDVd6FEXovdzujXnGnbJecWPSHVGv_k92eHjM_T5SbgJ48qHt5vjQ1GH8EOGgo4hGgF0yIyPlr97fYCODnFsnh-tkbvXsEhfmhgQwJu-cYaP6K5vUz2kR_y1rqJHpkXEk8tPvslMfYYC\", \"deep_link\": \"https://www.kiwi.com/deep?affilid=olliecroysdillgoyourway&currency=GBP&flightsId=0f6425c34b154b2a3b499574_0%7C0f6425c34b154b2a3b499574_1&from=LHR&lang=en&passengers=1&to=CDG&booking_token=EhXx47PEFKoS5nkLHYJDIv_2I5DmQ5DaPegGl6asIk4KM1L00ALMi_nde8sA6luFHY7ELF5fKR53nJl39m92O9_i_ZVduERgNgolm8AOPGIN3UuAui9_m3vE9MYyNmVsC3CxY9hUyqHH1MnzfyuV60zvdZzU6yMb07X_Cy_rszlRQtWihuPh9lLc-5ZhJ5bGtl1uBpef5TQcv9zogft3nB8IpC9P0NY_QKT6KFssCKT9Af_hSGf34HRP0lhD7dh3XGJLJcRC7YnqgIx2_npthUfAM4Q_gz3PVS52uIRhk61DWYLpRkrMTbDVd6FEXovdzujXnGnbJecWPSHVGv_k92eHjM_T5SbgJ48qHt5vjQ1GH8EOGgo4hGgF0yIyPlr97fYCODnFsnh-tkbvXsEhfmhgQwJu-cYaP6K5vUz2kR_y1rqJHpkXEk8tPvslMfYYC\", \"facilitated_booking_available\": true, \"pnr_count\": 1, \"has_airport_change\": false, \"technical_stops\": 0, \"throw_away_ticketing\": true, \"hidden_city_ticketing\": false, \"virtual_interlining\": false, \"local_arrival\": \"2022-08-17T11:15:00.000Z\", \"utc_arrival\": \"2022-08-17T09:15:00.000Z\", \"local_departure\": \"2022-08-17T08:55:00.000Z\", \"utc_departure\": \"2022-08-17T07:55:00.000Z\"}, {\"id\": \"0f6425c34b150000df5f2f7e_0\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"countryFrom\": {\"code\": \"GB\", \"name\": \"United Kingdom\"}, \"countryTo\": {\"code\": \"FR\", \"name\": \"France\"}, \"nightsInDest\": null, \"quality\": 715.788215, \"distance\": 348.3, \"duration\": {\"departure\": 4800, \"return\": 0, \"total\": 4800}, \"price\": 580, \"conversion\": {\"EUR\": 693.121605, \"GBP\": 580}, \"fare\": {\"adults\": 580, \"children\": 580, \"infants\": 580}, \"bags_price\": {\"1\": 57}, \"baglimit\": {\"hand_height\": 45, \"hand_length\": 56, \"hand_weight\": 23, \"hand_width\": 25, \"hold_dimensions_sum\": 208, \"hold_height\": 75, \"hold_length\": 90, \"hold_weight\": 23, \"hold_width\": 43, \"personal_item_height\": 30, \"personal_item_length\": 40, \"personal_item_weight\": 23, \"personal_item_width\": 15}, \"availability\": {\"seats\": 1}, \"airlines\": [\"BA\"], \"route\": [{\"id\": \"0f6425c34b150000df5f2f7e_0\", \"combination_id\": \"0f6425c34b150000df5f2f7e\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"airline\": \"BA\", \"flight_no\": 306, \"operating_carrier\": \"BA\", \"operating_flight_no\": \"306\", \"fare_basis\": \"\", \"fare_category\": \"M\", \"fare_classes\": \"Y\", \"fare_family\": \"\", \"return\": 0, \"bags_recheck_required\": false, \"vi_connection\": false, \"guarantee\": false, \"equipment\": null, \"vehicle_type\": \"aircraft\", \"local_arrival\": \"2022-08-17T11:15:00.000Z\", \"utc_arrival\": \"2022-08-17T09:15:00.000Z\", \"local_departure\": \"2022-08-17T08:55:00.000Z\", \"utc_departure\": \"2022-08-17T07:55:00.000Z\"}], \"booking_token\": \"EiFuJrwI4M1ask6xn-9LbIQWSyqkTies0KANfvd2OGSgVBei9zz5L70h4QWvexp1rUVUug9F1qbEWdjJWI81XExqPvNU3ePtprc0J_HPFmrLBWCUUaCxig18CGuzRUzjcJ90quiLLfjlZ9yZQDavCu6d2NOXuCDAiTOG9WXsi91CZ06vat0Gi3aUJeXkYfuzmUdrAy5TrWWf6y62e0heNR7JiuVO-YL8D3Y3qlH2wnno8cIDYaYYAPY3VTKVR29r9JzAQFYFtC80UL0uybpCaqLYR3toErv-OYWcZ0pbzNWGowqxGJJjV5iMXupGlpYvnNWGoQjjhvb9I66qqyMUcz9eqY77jxATVZg4AlZF_pDOFNeWBT8gI_w9fTTEcbttUeYHg85LACnP7pyKMDDwuZg==\", \"deep_link\": \"https://www.kiwi.com/deep?affilid=olliecroysdillgoyourway&currency=GBP&flightsId=0f6425c34b150000df5f2f7e_0&from=LHR&lang=en&passengers=1&to=CDG&booking_token=EiFuJrwI4M1ask6xn-9LbIQWSyqkTies0KANfvd2OGSgVBei9zz5L70h4QWvexp1rUVUug9F1qbEWdjJWI81XExqPvNU3ePtprc0J_HPFmrLBWCUUaCxig18CGuzRUzjcJ90quiLLfjlZ9yZQDavCu6d2NOXuCDAiTOG9WXsi91CZ06vat0Gi3aUJeXkYfuzmUdrAy5TrWWf6y62e0heNR7JiuVO-YL8D3Y3qlH2wnno8cIDYaYYAPY3VTKVR29r9JzAQFYFtC80UL0uybpCaqLYR3toErv-OYWcZ0pbzNWGowqxGJJjV5iMXupGlpYvnNWGoQjjhvb9I66qqyMUcz9eqY77jxATVZg4AlZF_pDOFNeWBT8gI_w9fTTEcbttUeYHg85LACnP7pyKMDDwuZg==\", \"facilitated_booking_available\": true, \"pnr_count\": 1, \"has_airport_change\": false, \"technical_stops\": 0, \"throw_away_ticketing\": false, \"hidden_city_ticketing\": false, \"virtual_interlining\": false, \"local_arrival\": \"2022-08-17T11:15:00.000Z\", \"utc_arrival\": \"2022-08-17T09:15:00.000Z\", \"local_departure\": \"2022-08-17T08:55:00.000Z\", \"utc_departure\": \"2022-08-17T07:55:00.000Z\"}, {\"id\": \"0f6425c34b1400000592e7fc_0\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"countryFrom\": {\"code\": \"GB\", \"name\": \"United Kingdom\"}, \"countryTo\": {\"code\": \"FR\", \"name\": \"France\"}, \"nightsInDest\": null, \"quality\": 715.788215, \"distance\": 348.3, \"duration\": {\"departure\": 4800, \"return\": 0, \"total\": 4800}, \"price\": 580, \"conversion\": {\"EUR\": 693.121605, \"GBP\": 580}, \"fare\": {\"adults\": 580, \"children\": 580, \"infants\": 580}, \"bags_price\": {\"1\": 57}, \"baglimit\": {\"hand_height\": 45, \"hand_length\": 56, \"hand_weight\": 23, \"hand_width\": 25, \"hold_dimensions_sum\": 208, \"hold_height\": 75, \"hold_length\": 90, \"hold_weight\": 23, \"hold_width\": 43, \"personal_item_height\": 30, \"personal_item_length\": 40, \"personal_item_weight\": 23, \"personal_item_width\": 15}, \"availability\": {\"seats\": 1}, \"airlines\": [\"BA\"], \"route\": [{\"id\": \"0f6425c34b1400000592e7fc_0\", \"combination_id\": \"0f6425c34b1400000592e7fc\", \"flyFrom\": \"LHR\", \"flyTo\": \"CDG\", \"cityFrom\": \"London\", \"cityCodeFrom\": \"LON\", \"cityTo\": \"Paris\", \"cityCodeTo\": \"PAR\", \"airline\": \"BA\", \"flight_no\": 328, \"operating_carrier\": \"BA\", \"operating_flight_no\": \"328\", \"fare_basis\": \"\", \"fare_category\": \"M\", \"fare_classes\": \"Y\", \"fare_family\": \"\", \"return\": 0, \"bags_recheck_required\": false, \"vi_connection\": false, \"guarantee\": false, \"equipment\": null, \"vehicle_type\": \"aircraft\", \"local_arrival\": \"2022-08-16T20:40:00.000Z\", \"utc_arrival\": \"2022-08-16T18:40:00.000Z\", \"local_departure\": \"2022-08-16T18:20:00.000Z\", \"utc_departure\": \"2022-08-16T17:20:00.000Z\"}], \"booking_token\": \"EEfgEw9dSToqgv25HVNX7dcAdl1Tby_3iyJHzu5up8wYBgd6OCqGxhMShGL17EbMhn5V9199syPzl1kAKv95rlz-J7-5q_Qzydx6llIfHZO7-pr-HpdVAATHT21oCrVkpGauSCCTqP-zjdBnMj0-Xe7hKwLgtUirzhERt6FyKFl7GB9usfi5zJtDJBCVxHNhak3TT31yhcDIfGLWwD3vxCyAseU-raE6J79YzEt0JDQdIJwn4sHLwDiNXzC05qOrJbXZ7rTHR50Dqxdqs51QVyvvhONF0UIwkHLdrT4NM4nY3tNyRjI2sTWpnB-45RAtQ2BTHVL0uqpq8ka1B6D62L-gylvmA73-I_qRHNRNlNVpgM2fGKxEZL1jE1yETfppjUFxmc27WPJwZl9C-0QSObQ==\", \"deep_link\": \"https://www.kiwi.com/deep?affilid=olliecroysdillgoyourway&currency=GBP&flightsId=0f6425c34b1400000592e7fc_0&from=LHR&lang=en&passengers=1&to=CDG&booking_token=EEfgEw9dSToqgv25HVNX7dcAdl1Tby_3iyJHzu5up8wYBgd6OCqGxhMShGL17EbMhn5V9199syPzl1kAKv95rlz-J7-5q_Qzydx6llIfHZO7-pr-HpdVAATHT21oCrVkpGauSCCTqP-zjdBnMj0-Xe7hKwLgtUirzhERt6FyKFl7GB9usfi5zJtDJBCVxHNhak3TT31yhcDIfGLWwD3vxCyAseU-raE6J79YzEt0JDQdIJwn4sHLwDiNXzC05qOrJbXZ7rTHR50Dqxdqs51QVyvvhONF0UIwkHLdrT4NM4nY3tNyRjI2sTWpnB-45RAtQ2BTHVL0uqpq8ka1B6D62L-gylvmA73-I_qRHNRNlNVpgM2fGKxEZL1jE1yETfppjUFxmc27WPJwZl9C-0QSObQ==\", \"facilitated_booking_available\": true, \"pnr_count\": 1, \"has_airport_change\": false, \"technical_stops\": 0, \"throw_away_ticketing\": false, \"hidden_city_ticketing\": false, \"virtual_interlining\": false, \"local_arrival\": \"2022-08-16T20:40:00.000Z\", \"utc_arrival\": \"2022-08-16T18:40:00.000Z\", \"local_departure\": \"2022-08-16T18:20:00.000Z\", \"utc_departure\": \"2022-08-16T17:20:00.000Z\"}], \"search_params\": {\"flyFrom_type\": \"airport\", \"to_type\": \"airport\", \"seats\": {\"passengers\": 1, \"adults\": 1, \"children\": 0, \"infants\": 0}}, \"all_stopover_airports\": [], \"sort_version\": 0}";


    @Mock
    private TequilaAPIService mockTequilaAPIService;

    @Mock
    private AirportRepository mockAirportRepository;

    @InjectMocks
    private FlightsService flightsService;

    private final Airport testAirport1 = new Airport("Gatwick","United Kingdom","London","LGW",51.148056,-0.190278);

    private final Airport testAirport2 = new Airport("secondTestAirportName","secondTestCountryName","secondTestCityName","secondTestAirportCode",11,54);

    @org.junit.Test

    public void tests_searchAirports_correctlyManipulatesJSONResponse() throws Exception {
        TequilaAPIService mockTequilaAPIService = mock(TequilaAPIService.class);
        AirportRepository mockAirportRepository = mock(AirportRepository.class);
        String searchText = "text";
        FlightsService flightsService = new FlightsService(mockTequilaAPIService,mockAirportRepository);
        when(mockTequilaAPIService.getRequestResponse("https://tequila-api.kiwi.com/locations/query","?term="+searchText+"&location_types=airport"))
                .thenReturn(new HttpEntity<>(testAirportSearchJsonResponse));

        List<Location> resultAirports = flightsService.searchLocations("airport",searchText);

        assertEquals(testAirport1,resultAirports.get(0));

    }

    @org.junit.Test
    public void tests_searchCities_correctlyManipulatesJSONResponse() throws Exception {
        TequilaAPIService mockTequilaAPIService = mock(TequilaAPIService.class);
        AirportRepository mockAirportRepository = mock(AirportRepository.class);
        String searchText = "text";
        FlightsService flightsService = new FlightsService(mockTequilaAPIService,mockAirportRepository);
        when(mockTequilaAPIService.getRequestResponse("https://tequila-api.kiwi.com/locations/query","?term="+searchText+"&location_types=city"))
                .thenReturn(new HttpEntity<>(testCitySearchJsonResponse));

        List<Location> resultCities = flightsService.searchLocations("city", searchText);

        assertEquals(new City("London","United Kingdom","LON"),resultCities.get(0));
    }

    @org.junit.Test
    public void tests_searchFlights_correctlyManipulatesJSONResponse() throws Exception {
        TequilaAPIService mockTequilaAPIService = mock(TequilaAPIService.class);
        AirportRepository mockAirportRepository = mock(AirportRepository.class);
        String locationType = "airport";
        String testDate = "testDate";
        String flyFrom = "testFrom";
        String flyTo = "testTo";
        int maxStopovers = 0;
        FlightsService flightsService = new FlightsService(mockTequilaAPIService,mockAirportRepository);
        String testQueryParams = "?date_from="+testDate+"&date_to="+testDate+"&fly_from="+locationType+":"+flyFrom+"&fly_to="+locationType+":"+flyTo+"&max_stopovers="+maxStopovers;

        when(mockTequilaAPIService.getRequestResponse("https://tequila-api.kiwi.com/v2/search", testQueryParams))
                .thenReturn(new HttpEntity<>(testFlightSearchJsonResponse));
        when(mockAirportRepository.findById("LHR")).thenReturn(Optional.of(testAirport1));
        when(mockAirportRepository.findById("CDG")).thenReturn(Optional.of(testAirport2));


        List<Flight> resultFlights = flightsService.searchFlights(testDate, locationType, flyFrom, locationType, flyTo);
        new Flight("testId",0,"testDepartureDate","testArrivalDate",1000,testAirport1,testAirport2,"BA");



        assertEquals(new Flight(
                "0f6425c34b144b294add7d64_0|0f6425c34b144b294add7d64_1",
                308, "2022-08-16T11:00:00.000Z","2022-08-16T13:20:00.000Z",4800,testAirport1,testAirport2,"BA"),resultFlights.get(0));
    }

    @org.junit.Test
    public void tests_searchFlights_correctlyThrowsException_whenIncorrectLocationTypeIsProvided() throws Exception {
        TequilaAPIService mockTequilaAPIService = mock(TequilaAPIService.class);
        AirportRepository airportRepository = mock(AirportRepository.class);
        String invalidLocationType = "notCityOrAirport";
        String testDate = "testDate";
        String flyFrom = "testFrom";
        String flyTo = "testTo";
        int maxStopovers = 0;
        String testQueryParams = "?date_from="+testDate+"&date_to="+testDate+"&fly_from="+invalidLocationType+":"+flyFrom+"&fly_to="+invalidLocationType+":"+flyTo+"&max_stopovers="+maxStopovers;
        FlightsService flightsService = new FlightsService(mockTequilaAPIService,airportRepository);

        assertThrows(InvalidLocationTypeException.class, ()->{
            flightsService.searchFlights(testDate, invalidLocationType, flyFrom, invalidLocationType, flyTo);
        });
    }









}
